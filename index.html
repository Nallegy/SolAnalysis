<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Mexico: Strategic Resilience Interactive Brief</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals with Strategic Accents -->
    <!-- Application Structure Plan: A top-down narrative SPA. It starts with a high-level strategic vision, then allows users to explore four key investment pillars. The core interaction is a customizable AI analysis tool and a dynamic chart showing the economic transformation at the border. The structure is designed to guide investors from the "what" (the opportunity) to the "why" (the data) and finally the "how" (customized insight), making a complex report easily digestible and persuasive. -->
    <!-- Visualization & Content Choices: Report Info: NM's economic potential. -> Goal: Inform & Persuade investors. -> Viz/Presentation Method: Interactive cards, and a dynamic Chart.js bar chart. -> Interaction: Users can toggle the chart's dataset and generate highly customized, role-specific SWOT analyses for each pillar using the Gemini API. -> Justification: This approach transforms a static brief into a dynamic intelligence tool, providing on-demand AI analysis to build a strong investment case. -> Library/Method: Tailwind CSS, Vanilla JS, Chart.js (Canvas), Gemini API. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fdfcfb;
            color: #1a202c;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: auto;
            aspect-ratio: 16 / 9;
        }
        .pillar-icon {
            transition: transform 0.3s ease-in-out;
        }
        .pillar-icon:hover {
            transform: scale(1.1);
        }
        .sticky-nav {
            position: sticky;
            top: 0;
            z-index: 50;
            transition: background-color 0.3s, box-shadow 0.3s;
        }
        .nav-scrolled {
            background-color: rgba(253, 252, 251, 0.8);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .btn-primary {
            background-color: #2c5282;
            color: white;
            transition: background-color 0.3s;
        }
        .btn-primary:hover {
            background-color: #2a4365;
        }
        .btn-secondary {
            background-color: #e2e8f0;
            color: #2d3748;
            transition: background-color 0.3s;
        }
        .btn-secondary:hover {
            background-color: #cbd5e0;
        }
        .btn-ai {
            background: linear-gradient(45deg, #4299e1, #9f7aea);
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn-ai:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .btn-active {
            background-color: #2c5282;
            color: white;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            transition: opacity 0.3s ease;
        }
        .modal-content {
            max-height: 90vh;
            overflow-y: auto;
            width: 90%;
            max-width: 640px;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .custom-select {
            background-color: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            padding: 0.5rem 0.75rem;
            color: #2d3748;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }
        .prose h2 { margin-top: 1rem; margin-bottom: 0.5rem; font-size: 1.25rem; font-weight: 600; }
        .prose h3 { margin-top: 0.75rem; margin-bottom: 0.25rem; font-size: 1.1rem; font-weight: 600; }
        .prose ul { list-style-position: inside; }
        .prose li { margin-left: 1rem; }
    </style>
</head>
<body class="antialiased">

    <header id="sticky-nav" class="sticky-nav">
        <div class="container mx-auto px-4">
            <nav class="flex items-center justify-between py-4">
                <div class="text-2xl font-bold text-gray-800">
                    <a href="#home">Sol Innovations</a>
                </div>
                <div class="hidden md:flex items-center space-x-2 lg:space-x-4">
                    <a href="#pillars" class="text-gray-600 hover:text-blue-800 px-3 py-2 rounded-md text-sm font-medium">Pillars</a>
                    <a href="#borderplex" class="text-gray-600 hover:text-blue-800 px-3 py-2 rounded-md text-sm font-medium">Borderplex</a>
                    <a href="#outlook" class="text-gray-600 hover:text-blue-800 px-3 py-2 rounded-md text-sm font-medium">Outlook</a>
                    <a href="#contact" class="btn-primary px-4 py-2 rounded-md text-sm font-medium">Contact Us</a>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="text-gray-800 hover:text-blue-800 focus:outline-none">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                    </button>
                </div>
            </nav>
        </div>
        <div id="mobile-menu" class="hidden md:hidden">
            <a href="#pillars" class="block text-gray-600 hover:text-blue-800 px-4 py-2 text-sm font-medium">Pillars</a>
            <a href="#borderplex" class="block text-gray-600 hover:text-blue-800 px-4 py-2 text-sm font-medium">Borderplex</a>
            <a href="#outlook" class="block text-gray-600 hover:text-blue-800 px-4 py-2 text-sm font-medium">Outlook</a>
            <a href="#contact" class="block bg-blue-800 text-white px-4 py-2 text-sm font-medium">Contact Us</a>
        </div>
    </header>

    <main>
        <section id="home" class="py-20 md:py-32 bg-gray-50">
            <div class="container mx-auto px-4 text-center">
                <h1 class="text-4xl md:text-6xl font-bold text-gray-800 leading-tight">
                    New Mexico: Catalyzing a New Era of American Manufacturing & Strategic Resilience
                </h1>
                <p class="mt-6 text-lg md:text-xl text-gray-600 max-w-3xl mx-auto">
                    This strategic brief showcases the macro-regional investment potential at the intersection of energy sovereignty, critical minerals, advanced manufacturing, and AI-optimized logistics.
                </p>
                <div class="mt-10">
                    <a href="#contact" class="btn-primary px-8 py-4 rounded-lg text-lg font-semibold">
                        Request Bespoke Analysis
                    </a>
                </div>
            </div>
        </section>

        <section id="pillars" class="py-20">
            <div class="container mx-auto px-4">
                <h2 class="text-3xl font-bold text-center text-gray-800 mb-4">The Four Pillars of Strategic Growth</h2>
                <p class="text-center text-gray-600 max-w-2xl mx-auto mb-12">New Mexico stands at the intersection of four critical vectors driving the next wave of American industrial growth. Explore each pillar and generate a real-time, customized AI analysis to understand the depth of the opportunity from your unique perspective.</p>
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
                    
                    <div class="p-8 bg-white rounded-xl shadow-lg border border-gray-200 flex flex-col">
                        <div class="pillar-icon flex justify-center mb-4">
                            <svg class="w-16 h-16 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                        </div>
                        <h3 class="text-xl font-bold mb-2 text-center">Energy Sovereignty</h3>
                        <p class="text-gray-600 text-center flex-grow">Unmatched potential in next-generation geothermal and renewables to power high-demand sectors like AI data centers.</p>
                        <button class="ai-analysis-btn mt-6 w-full py-2 px-4 rounded-md font-semibold btn-ai" data-pillar="energy" data-pillar-title="Energy Sovereignty">✨ Generate AI Analysis</button>
                    </div>

                    <div class="p-8 bg-white rounded-xl shadow-lg border border-gray-200 flex flex-col">
                        <div class="pillar-icon flex justify-center mb-4">
                             <svg class="w-16 h-16 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9V3m0 18a9 9 0 009-9M3 12a9 9 0 019-9m0 18a9 9 0 00-9-9m9-9V3m0 0a9 9 0 00-9 9"></path></svg>
                        </div>
                        <h3 class="text-xl font-bold mb-2 text-center">Critical Minerals Access</h3>
                        <p class="text-gray-600 text-center flex-grow">Rich, untapped deposits of rare earth elements essential for defense, electrification, and semiconductor manufacturing.</p>
                        <button class="ai-analysis-btn mt-6 w-full py-2 px-4 rounded-md font-semibold btn-ai" data-pillar="minerals" data-pillar-title="Critical Minerals Access">✨ Generate AI Analysis</button>
                    </div>

                    <div class="p-8 bg-white rounded-xl shadow-lg border border-gray-200 flex flex-col">
                        <div class="pillar-icon flex justify-center mb-4">
                            <svg class="w-16 h-16 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
                        </div>
                        <h3 class="text-xl font-bold mb-2 text-center">Advanced Manufacturing</h3>
                        <p class="text-gray-600 text-center flex-grow">A burgeoning ecosystem anchored by major investments from Intel and emerging defense innovators like Anduril.</p>
                        <button class="ai-analysis-btn mt-6 w-full py-2 px-4 rounded-md font-semibold btn-ai" data-pillar="manufacturing" data-pillar-title="Advanced Manufacturing">✨ Generate AI Analysis</button>
                    </div>

                    <div class="p-8 bg-white rounded-xl shadow-lg border border-gray-200 flex flex-col">
                        <div class="pillar-icon flex justify-center mb-4">
                            <svg class="w-16 h-16 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
                        </div>
                        <h3 class="text-xl font-bold mb-2 text-center">AI-Optimized Logistics</h3>
                        <p class="text-gray-600 text-center flex-grow">A strategic position within the Borderplex economic zone, primed for AI-driven optimization of North American supply chains.</p>
                        <button class="ai-analysis-btn mt-6 w-full py-2 px-4 rounded-md font-semibold btn-ai" data-pillar="logistics" data-pillar-title="AI-Optimized Logistics">✨ Generate AI Analysis</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="borderplex" class="py-20 bg-gray-50">
            <div class="container mx-auto px-4">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold text-gray-800">The Borderplex Transformation: A Tale of Two Cities</h2>
                    <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">The nearshoring phenomenon is not just relocating jobs; it's transforming the industrial base. The data reveals a critical divergence between El Paso, TX, and Ciudad Juárez, Mexico, signaling a shift from labor-intensive assembly to high-tech, capital-intensive manufacturing.</p>
                </div>
                <div class="chart-container bg-white p-4 rounded-lg shadow-md">
                    <canvas id="borderplexChart"></canvas>
                </div>
                <div class="mt-6 text-center">
                    <p class="text-gray-600 mb-4">Toggle between datasets to see the trend:</p>
                    <div id="chart-controls" class="flex justify-center space-x-4">
                        <button id="btn-total" class="px-4 py-2 rounded-md font-semibold btn-secondary btn-active">Total Employment</button>
                        <button id="btn-mfg" class="px-4 py-2 rounded-md font-semibold btn-secondary">Manufacturing Employment</button>
                    </div>
                </div>
            </div>
        </section>


        <section id="outlook" class="py-20">
            <div class="container mx-auto px-4">
                <h2 class="text-3xl font-bold text-center text-gray-800 mb-12">Strategic Financial & Investment Outlook</h2>
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="p-8 bg-white rounded-xl shadow-lg border border-gray-200">
                        <h3 class="text-xl font-bold mb-4 text-blue-800">Economic Upside</h3>
                        <ul class="space-y-3 text-gray-600 list-disc list-inside">
                            <li>Catalyzes high-skill job creation</li>
                            <li>Drives long-term regional GDP growth</li>
                            <li>Attracts significant secondary capital inflows</li>
                            <li>Favorable fiscal standing for public-private partnerships</li>
                        </ul>
                    </div>
                    <div class="p-8 bg-white rounded-xl shadow-lg border border-gray-200">
                        <h3 class="text-xl font-bold mb-4 text-green-800">Risk Management Advantages</h3>
                        <ul class="space-y-3 text-gray-600 list-disc list-inside">
                            <li>Reduced foreign dependency ensures supply chain stability</li>
                            <li>Domestic energy corridors insulate from global energy shocks</li>
                            <li>Defense manufacturing offers recession-resilient revenue</li>
                        </ul>
                    </div>
                    <div class="p-8 bg-white rounded-xl shadow-lg border border-gray-200">
                        <h3 class="text-xl font-bold mb-4 text-purple-800">Primary Investment Channels</h3>
                        <ul class="space-y-3 text-gray-600 list-disc list-inside">
                            <li>Next-gen energy infrastructure (geothermal, microgrids)</li>
                            <li>Critical mineral exploration, development, and refining</li>
                            <li>High-tech industrial parks and advanced logistics hubs</li>
                            <li>Workforce housing and educational innovation zones</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section id="contact" class="py-20 bg-gray-800 text-white">
            <div class="container mx-auto px-4 text-center">
                <h2 class="text-3xl font-bold">Partner With Us for Strategic Foresight</h2>
                <div class="mt-8 bg-gray-700 p-8 rounded-lg max-w-4xl mx-auto text-left">
                    <h3 class="text-2xl font-bold mb-4 text-white">About Sol Innovations</h3>
                    <div class="text-gray-300 space-y-4">
                        <p>Sol Innovations is a U.S. A.F. veteran-owned strategic intelligence firm based out of southern NM. We see the patterns others miss by blending scientific rigor with deep anthropological insight. Using proprietary AI modeling (UET-Net), we deliver precise, actionable intelligence to investors, executives, and policymakers.</p>
                        <p class="text-lg italic text-gray-200 mt-6">"Our goal is to drive strategic investment to build a decentralized, secure, and robust society. It's time to update civilization."</p>
                    </div>
                    <div class="mt-8 border-t border-gray-600 pt-6">
                        <p class="font-semibold text-lg">John Michael Narvaez</p>
                        <p class="text-gray-400">Founder & Lead Analyst</p>
                        <a href="mailto:SolInno@proton.me" class="mt-2 inline-block text-blue-400 hover:text-blue-300">SolInno@proton.me</a>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div id="ai-modal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div class="bg-white rounded-lg shadow-xl p-6 modal-content" tabindex="-1">
            <div class="flex justify-between items-center border-b pb-3">
                <h3 id="modal-title" class="text-xl font-bold text-gray-800">AI-Generated Analysis</h3>
                <button id="modal-close-btn" class="text-gray-500 hover:text-gray-800 text-3xl leading-none" aria-label="Close modal">&times;</button>
            </div>
            <div id="modal-body" class="mt-4">
                <!-- Content injected here -->
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const stickyNav = document.getElementById('sticky-nav');

            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });

            window.addEventListener('scroll', () => {
                if (window.scrollY > 10) {
                    stickyNav.classList.add('nav-scrolled');
                } else {
                    stickyNav.classList.remove('nav-scrolled');
                }
            });
            
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    if (mobileMenu.classList.contains('hidden') === false) {
                        mobileMenu.classList.add('hidden');
                    }
                    document.querySelector(this.getAttribute('href')).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });

            const datasets = {
                total: {
                    label: 'Total Employment Change (YoY)',
                    elPaso: 7200,
                    juarez: -10600,
                    backgroundColor: ['rgba(59, 130, 246, 0.6)', 'rgba(239, 68, 68, 0.6)'],
                    borderColor: ['rgba(59, 130, 246, 1)', 'rgba(239, 68, 68, 1)'],
                },
                manufacturing: {
                    label: 'Manufacturing Employment Change (YoY)',
                    elPaso: 200,
                    juarez: -11100,
                    backgroundColor: ['rgba(34, 197, 94, 0.6)', 'rgba(239, 68, 68, 0.6)'],
                    borderColor: ['rgba(34, 197, 94, 1)', 'rgba(239, 68, 68, 1)'],
                }
            };

            const ctx = document.getElementById('borderplexChart').getContext('2d');
            const borderplexChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['El Paso, TX', 'Ciudad Juárez, MX'],
                    datasets: [{
                        label: datasets.total.label,
                        data: [datasets.total.elPaso, datasets.total.juarez],
                        backgroundColor: datasets.total.backgroundColor,
                        borderColor: datasets.total.borderColor,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Year-over-Year Employment Change (April 2025)',
                            font: { size: 16 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += new Intl.NumberFormat('en-US').format(context.parsed.y) + ' jobs';
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value, index, values) {
                                    return new Intl.NumberFormat('en-US').format(value);
                                }
                            },
                            title: {
                                display: true,
                                text: 'Number of Jobs (Change)'
                            }
                        }
                    }
                }
            });

            const btnTotal = document.getElementById('btn-total');
            const btnMfg = document.getElementById('btn-mfg');
            const chartControls = document.getElementById('chart-controls');

            function updateChart(datasetKey) {
                const newDataset = datasets[datasetKey];
                borderplexChart.data.datasets[0].label = newDataset.label;
                borderplexChart.data.datasets[0].data = [newDataset.elPaso, newDataset.juarez];
                borderplexChart.data.datasets[0].backgroundColor = newDataset.backgroundColor;
                borderplexChart.data.datasets[0].borderColor = newDataset.borderColor;
                borderplexChart.update();

                Array.from(chartControls.children).forEach(button => {
                    button.classList.remove('btn-active');
                });

                if(datasetKey === 'total') {
                    btnTotal.classList.add('btn-active');
                } else {
                    btnMfg.classList.add('btn-active');
                }
            }

            btnTotal.addEventListener('click', () => updateChart('total'));
            btnMfg.addEventListener('click', () => updateChart('manufacturing'));

            const aiModal = document.getElementById('ai-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            
            const roles = ["Institutional Investor", "Financial Advisor", "Family Office Manager", "Strategic Analyst", "Policymaker"];
            const focuses = ["General Investment", "Agriculture & Commodities", "Cryptocurrency & Digital Assets", "Technology & AI", "National Security"];

            function showCustomizationOptions(pillar, pillarTitle) {
                modalTitle.textContent = `Customize AI Analysis: ${pillarTitle}`;
                modalBody.innerHTML = `
                    <div class="space-y-6">
                        <div>
                            <p class="text-gray-600 mb-4">A <strong class="font-semibold">SWOT analysis</strong> is a strategic planning technique used to identify Strengths, Weaknesses, Opportunities, and Threats related to a business venture or project. Customize the analysis below to fit your perspective.</p>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label for="role-select" class="block text-sm font-medium text-gray-700 mb-1">Your Role:</label>
                                <select id="role-select" class="w-full custom-select">
                                    ${roles.map(role => `<option value="${role}">${role}</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label for="focus-select" class="block text-sm font-medium text-gray-700 mb-1">Your Focus Area:</label>
                                <select id="focus-select" class="w-full custom-select">
                                    ${focuses.map(focus => `<option value="${focus}">${focus}</option>`).join('')}
                                </select>
                            </div>
                        </div>
                        <div class="pt-4">
                             <button id="generate-custom-btn" class="w-full py-3 px-4 rounded-lg font-semibold btn-primary">Generate Customized Analysis</button>
                        </div>
                    </div>
                `;
                aiModal.classList.remove('hidden');
                aiModal.focus();

                document.getElementById('generate-custom-btn').addEventListener('click', () => {
                    const selectedRole = document.getElementById('role-select').value;
                    const selectedFocus = document.getElementById('focus-select').value;
                    generateAndShowAnalysis(pillar, pillarTitle, selectedRole, selectedFocus);
                });
            }

            async function generateAndShowAnalysis(pillar, pillarTitle, role, focus) {
                modalBody.innerHTML = `<div class="flex justify-center items-center h-48"><div class="loader"></div></div>`;
                
                const prompt = `Acting as a ${role} with a specialized focus on ${focus}, generate a concise yet insightful SWOT analysis for investing in New Mexico's "${pillarTitle}" pillar. Analyze the second-order effects relevant to my focus. For example, if the focus is Agriculture, consider water rights and logistics. If the focus is National Security, consider supply chain resilience and dual-use technologies. The response must be in Markdown format with clear headings for Strengths, Weaknesses, Opportunities, and Threats.`;

                const apiKey = "AIzaSyDgj3yhwehh5rx8JWG_adSeEDqDQhFBBkg"; // <-- PASTE YOUR GOOGLE AI API KEY HERE
                if (apiKey === "YOUR_API_KEY_HERE" || !apiKey) {
                    modalBody.innerHTML = '<p class="text-red-500 font-semibold">API Key Error:</p><p class="text-gray-600 mt-2">The API key is missing. To enable this feature, please get a free API key from Google AI Studio and add it to the `apiKey` variable in the code.</p>';
                    return;
                }
                
                const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                
                let retries = 3;
                let delay = 1000;
                let success = false;

                for (let i = 0; i < retries; i++) {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (response.ok) {
                            const result = await response.json();
                            if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts[0].text) {
                                const markdown = result.candidates[0].content.parts[0].text;
                                modalBody.innerHTML = `<div class="prose max-w-none">${marked.parse(markdown)}</div>`;
                                success = true;
                                break;
                            }
                        } else {
                            throw new Error(`API error: ${response.status}`);
                        }
                    } catch (error) {
                        console.error('Fetch error:', error);
                        await new Promise(res => setTimeout(res, delay));
                        delay *= 2;
                    }
                }

                if (!success) {
                    modalBody.innerHTML = '<p class="text-red-500">Analysis generation failed after retries. Please check your API key or network connection and try again.</p>';
                }
            }

            document.querySelectorAll('.ai-analysis-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const pillar = e.target.dataset.pillar;
                    const pillarTitle = e.target.dataset.pillarTitle;
                    showCustomizationOptions(pillar, pillarTitle);
                });
            });
            
            function closeModal() {
                aiModal.classList.add('hidden');
                modalBody.innerHTML = '';
            }

            modalCloseBtn.addEventListener('click', closeModal);
            aiModal.addEventListener('click', (e) => {
                if (e.target === aiModal) {
                    closeModal();
                }
            });
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && !aiModal.classList.contains('hidden')) {
                    closeModal();
                }
            });
        });
    </script>
</body>
</html>
